<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Character Turnaround</title>
<style>
  :root{
    --bg-base: #a25647;
    --bg-grad-1: rgba(255,255,255,0.30);
    --bg-grad-2: rgba(255,255,255,0.00);
    --bg-grad-3: rgba(0,0,0,0.00);
    --bg-grad-4: rgba(0,0,0,0.40);

    --title-size: clamp(22px, 4.5vw, 44px);
    --price-size: clamp(18px, 2.7vw, 48px);
    --control-size: clamp(28px, 6vw, 50px);
    --arrow-offset: clamp(14px, 5vw, 64px);
    --logo-top-w: clamp(260px, 26vw, 340px);
    --logo-bottom-w: clamp(200px, 26vw, 340px);
    --ui-gap: clamp(6px, 2vw, 12px);

    --char-base: min(350vmin, 425px);
    --safe-top: clamp(175px, 20vh, 220px);
    --safe-bottom: clamp(110px, 20vh, 220px);
  }

  html, body { height: 100%; }
  body{
    margin: 0;
    font-family: "Segoe UI", system-ui, -apple-system, Roboto, sans-serif;
    background:
      linear-gradient(to bottom, var(--bg-grad-1), var(--bg-grad-2) 20%),
      linear-gradient(to bottom, var(--bg-grad-3) 40%, var(--bg-grad-4) 100%),
      var(--bg-base);
    background-blend-mode: overlay;
    color: #fff;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow: hidden;
  }

  /* Logos and header */
  #topLogo{ width: var(--logo-top-w); position: fixed; top: max(28px, env(safe-area-inset-top)); left:50%; transform:translateX(-50%); z-index:12; pointer-events:none }
  #logo{ width: var(--logo-bottom-w); position: fixed; bottom: calc(max(18px, env(safe-area-inset-bottom)) + 6px); left:50%; transform:translateX(-50%); z-index:12; pointer-events:none }

  #charName{ position: fixed; top: calc(max(8px, env(safe-area-inset-top)) + 70px); left:50%; transform:translateX(-50%); font-size:var(--title-size); font-weight:800; text-align:center; z-index:12; text-shadow: 2px 2px 8px rgba(0,0,0,0.6); }
  #priceContainer {
    position: fixed;
    top: calc(max(8px, env(safe-area-inset-top)) + 70px + 62px);
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--price-size);
    z-index: 12;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
    white-space: nowrap;          /* keep price and mcap on a single line */
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 78vw;              /* avoid excessively long text overflowing viewport */
  }
  
  

  /* üîπ Make title bigger only on mobile */
@media (max-width: 767px) {
  #charName {
    font-size: calc(var(--title-size) * 2.3); /* adjust multiplier as needed */
  }
}
  
  /* NEW: 24h change under price */
  #change24h {
  position: fixed;
  top: calc(max(18px, env(safe-area-inset-top)) + 70px + 62px + 48px); /* below priceContainer */
  left: 70%;
  transform: translateX(-50%);
  font-size: 0.8em;
  z-index: 12;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
}

  /* üì± Mobile (up to 600px) */
@media (max-width: 600px) {
  #change24h {
    top: 220px;   /* adjust manually for mobile */
    left: 72%;    /* center it better on small screens */
    font-size: 1em; /* maybe make it a bit bigger */
  }
}

/* üíª Desktop (601px and above) */
@media (min-width: 601px) {
  #change24h {
    top: 220px;   /* adjust manually for desktop */
    left: 63%;    /* keep it offset if you want */
    font-size: 1em;
  }
}

  /* Character centered area */
  #characterWrap{ position: fixed; inset: var(--safe-top) 0 var(--safe-bottom) 0; display:grid; place-items:center; z-index:6; pointer-events:none }
  #character{ max-width: calc(var(--char-base)); max-height:100%; width: calc(var(--char-base) * var(--char-size, 1)); height:auto; object-fit:contain; transition: transform .22s ease, filter .22s ease; pointer-events:auto }
  .glow{ filter: drop-shadow(0 0 15px #fff) drop-shadow(0 0 30px #fff) }

  /* Arrow Buttons (emoji-only) */
  .arrowBtn {
    position: fixed;
    font-size: var(--control-size);  /* size of arrows */
    padding: 0;                      /* no extra padding so emoji is natural size */
    background: none;
    border: none;
    color: #fff;
    z-index: 12;
    cursor: pointer;
    line-height: 1;                 /* centers emoji */
    -webkit-tap-highlight-color: transparent;
  }

  .arrowBtn.left {
    top: 50%;
    left: var(--arrow-offset);
    transform: translateY(-52%);
  }

  .arrowBtn.right {
    top: 50%;
    right: var(--arrow-offset);
    transform: translateY(-52%);
  }

  /* Left stacked emoji function buttons (aligned under left arrow) */
  .leftControls {
    position: fixed;
    left: var(--arrow-offset);
    top: calc(50% + var(--control-size) + 12px); /* slightly below arrow */
    display: flex;
    flex-direction: column;
    gap: 12px; /* space between each button */
    z-index: 12;
  }
  .leftControls button {
    background: none;
    border: none;
    color: #fff;
    padding: 0;
    border-radius: 0;
    font-size: var(--control-size); /* same size as arrow */
    cursor: pointer;
    line-height: 1;                 /* centers emoji */
    box-shadow: none;
    -webkit-tap-highlight-color: transparent;
  }
  .leftControls button:active {
    transform: scale(0.95);
  }

  /* Particle canvas (replaces old snowCanvas) */
  #particleCanvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  /* Top-left effect toggle button */
  #effectToggle {
  position: fixed;
  left: var(--arrow-offset);
  top: 30%;
  transform: translateY(-50%);
  z-index: 12;
  display: flex;
  flex-direction: column;
  align-items: center; /* centers the emojis horizontally */
  font-size: var(--control-size); /* same size as left buttons */
  background: none;
  border: none;
  color: #fff;
  padding: 0;
  cursor: pointer;
  line-height: 1; 
  -webkit-tap-highlight-color: transparent;
}


  /* Title effects */
  .effect-rainbow{ animation: hue 5s linear infinite }
  @keyframes hue{ from{filter:hue-rotate(0deg)} to{filter:hue-rotate(360deg)} }
  .effect-flicker{ animation: flick 1.6s infinite }
  @keyframes flick{ 0%,19%,21%,100%{opacity:1} 20%,22%{opacity:.4} }
  .effect-glitch{ position: relative }
  .effect-glitch::after{ content: attr(data-text); position:absolute; inset:0; left:2px; top:0; text-shadow:-2px 0 rgba(0,255,255,.8); clip-path: inset(0 0 60% 0); animation: glitch 1.5s infinite ease-in-out alternate }
  @keyframes glitch{ from{ transform: translateX(0)} to{ transform: translateX(1.5px)} }
  .effect-shadowPulse{ text-shadow:0 0 10px rgba(255,255,255,.85); animation:pulse 2.2s ease-in-out infinite }
  @keyframes pulse{ 0%,100%{ text-shadow:0 0 8px rgba(255,255,255,.5)} 50%{ text-shadow:0 0 20px rgba(255,255,255,1)} }

  @media (prefers-reduced-motion: reduce){ .effect-rainbow,.effect-flicker,.effect-glitch,.effect-shadowPulse{ animation:none !important } }

/* === Social Links Floating Above Everything (Centered) === */
#socialLinks {
  position: fixed;       /* float above all content */
  top: 550px;           /* distance from top of viewport */
  left: 50%;             /* start at 50% of viewport width */
  transform: translateX(-50%); /* center horizontally */
  display: flex;
  gap: 12px;             /* space between icons */
  z-index: 9999;         /* ensures it‚Äôs above everything */
}

#socialLinks img {
  width: 32px;
  height: 32px;
  filter: drop-shadow(0 0 4px rgba(0,0,0,0.5));
  transition: transform 0.2s ease;
  cursor: pointer;
}

#socialLinks img:hover {
  transform: scale(1.2);
}
</style>
</head>
<body>

  <!-- Particle layer (snow / blood / candles) -->
  <canvas id="particleCanvas" aria-hidden="true"></canvas>

  <!-- Toggle for particle effects (cycles) -->
  <button id="effectToggle" aria-pressed="false" title="Cycle particle effects">‚ùÑÔ∏è</button>

  <!-- Fixed Logos -->
  <img id="topLogo" src="https://i.postimg.cc/J4jjNvTq/memspin1.png" alt="Top Logo" />
  <img id="logo"    src="https://i.postimg.cc/Jhbq2Yzd/power2f.png"  alt="Bottom Logo" />

  <!-- Header: Title & Price -->
  <div id="charName" aria-live="polite"></div>
  <div id="priceContainer" aria-live="polite">Loading price‚Ä¶</div>
  <div id="change24h" aria-live="polite"></div>

  <!-- Character (auto-centered between safe areas) -->
  <div id="characterWrap">
    <img id="character" src="" alt="Character" />
  </div>
  
  <div id="socialLinks">
  <a id="socialX" href="#" target="_blank" title="X / Twitter">
    <img src="https://i.postimg.cc/jSSK7CPW/XICON.png" alt="X Icon" width="28" height="28" />
  </a>
  <a id="socialWeb" href="#" target="_blank" title="Website">
    <img src="https://i.postimg.cc/3xfhC7Ft/WICON.png" alt="Website Icon" width="28" height="28" />
  </a>
</div>

  <!-- Left stacked controls under left arrow (emoji-only) -->
  <div class="leftControls" role="group" aria-label="Character controls">
    <button id="turnBtn" title="Spin">üîÑ</button>
    <button id="effectBtn" title="Glow on/off">‚ú®</button>
    <button id="paintBtn" title="Change background">üé®</button>
  </div>

  <!-- Arrow Navigation (emoji-only) -->
  <button class="arrowBtn left"  id="prevChar" title="Previous">‚¨ÖÔ∏è</button>
  <button class="arrowBtn right" id="nextChar" title="Next">‚û°Ô∏è</button>

<script>
  // ===== Config toggles =====
  const FORCE_UPPERCASE = true;
  const ENABLE_TITLE_EFFECTS = true;
  const EFFECTS_POOL = ["effect-rainbow","effect-glitch","effect-flicker","effect-shadowPulse"];

  // ===== Characters (KEEP SENSITIVE DATA) =====
  const characters = [
    { name: "Billie", frames: [
      "https://i.postimg.cc/0Nnd1g1C/UnoRe.png",
      "https://i.postimg.cc/KYxrWGwz/DosRe.png",
      "https://i.postimg.cc/654021C9/TresRe.png",
      "https://i.postimg.cc/cLqcQMcf/CuatroRe.png",
      "https://i.postimg.cc/YC1z8GXZ/CincoRe.png"
    ], size: 1.05, spinSpeed: 230, pairId:"GNEqyxGV9u8Hz5G3RX1VxUfWCQFuXEP2ckmbLxe1bmyf", supply: 999940952,
     x: "https://x.com/juujuumama",        // <-- add X link here
    website: "https://www.billietheblueyeti.com/"},

    { name: "Bagz", frames: [
      "https://i.postimg.cc/76DxBpz7/Bagz1.png",
      "https://i.postimg.cc/Qd2N7Bxf/Bagz2.png",
      "https://i.postimg.cc/fRtTk7Z3/Bagz3.png",
      "https://i.postimg.cc/QMc8JXFh/Bagz4.png",
    ], size: 1.0, spinSpeed: 220, pairId: "4MzZA4pqd7HqU9gQKuLSwtC5nUxFpmw5PvRmGoSGMNxF", supply: 1000000000,
     x: "https://x.com/BagzBunnies",        // <-- add X link here
    website: "https://bagz.world/"},

    { name: "Finn", frames: [
      "https://i.postimg.cc/nLyzPYHZ/FinnUNO.png",
      "https://i.postimg.cc/gksx2ZKq/FINNDOS.png",
      "https://i.postimg.cc/7LGh9Qrm/FINNTRES.png",
      "https://i.postimg.cc/hPcJnrVt/FINNCUATRO.png",
      "https://i.postimg.cc/65PyZNDy/FINNCINCO.png",
      "https://i.postimg.cc/13zfn3Cx/FINNSEIS.png",
      "https://i.postimg.cc/yYpSTRS6/FINNSIETE.png",
      "https://i.postimg.cc/prYp8hMv/FINNOCHO.png"
    ], size: 0.90, spinSpeed: 210, pairId:"3kZxw7r663dNYqbw8zGCK7NRrcBMXMcRnv3heak4F7mC", supply: 985377686,
     x: "https://x.com/FinnOnBagsApp",        // <-- add X link here
    website: ""},

    { name: "Nippie", frames: [
      "https://i.postimg.cc/5y4Zq3Pn/NIPPIE1.png",
      "https://i.postimg.cc/sX9kh8JM/NIPPIE2.png",
      "https://i.postimg.cc/nzJ8MZq8/NIPPIE3.png",
      "https://i.postimg.cc/wMwnWmZH/NIPPIE4.png",
      "https://i.postimg.cc/T2Q82zwS/NIPPIE5.png",
      "https://i.postimg.cc/kX502TR5/NIPPIE6.png"
    ], size: 0.90, spinSpeed: 220, pairId:"ENYbntd3KgJJJvMqbe5Awtqu8jkVjnczU8TK46q3odnG", supply: 954759985,
     x: "https://x.com/TheNippies",        // <-- add X link here
    website: "https://nippi.es/"},

    { name: "Anon", frames: [
      "https://i.postimg.cc/yYZPj0zX/Anon1.png",
      "https://i.postimg.cc/MZ451dgp/Anon2.png",
      "https://i.postimg.cc/KjK5dM3b/Anon3.png",
      "https://i.postimg.cc/RhjT9ZwH/Anon3B.png",
      "https://i.postimg.cc/3xQZcW8M/Anon4.png",
      "https://i.postimg.cc/fR7vnZyV/Anon5.png",
      "https://i.postimg.cc/zf0Svjn5/Anon6.png",
      "https://i.postimg.cc/d0qjJXZ4/Anon7.png",
      "https://i.postimg.cc/FHfmBm43/Anon8.png"
    ], size: 0.80, spinSpeed: 220, pairId:"8eQTQLnBmEgeY9avVjrqqgX8ZVr8MRFrXEHpMrx6DGff", supply: 1000000000,
     x: "https://x.com/i/communities/1954607470753861824",        // <-- add X link here
    website: ""},

    { name: "NYAN", frames: [
      "https://i.postimg.cc/mDjqJvGF/frame-00-delay-0-07s.gif",
      "https://i.postimg.cc/HsRNq0F3/frame-01-delay-0-07s.gif",
      "https://i.postimg.cc/9MCKxWsh/frame-02-delay-0-07s.gif",
      "https://i.postimg.cc/QxHPYYYH/frame-03-delay-0-07s.gif",
      "https://i.postimg.cc/Z5NQ4BSm/frame-04-delay-0-07s.gif",
      "https://i.postimg.cc/8CV05pp6/frame-05-delay-0-07s.gif",
      "https://i.postimg.cc/YSfyL50y/frame-06-delay-0-07s.gif",
      "https://i.postimg.cc/k4JYQTtM/frame-07-delay-0-07s.gif",
      "https://i.postimg.cc/0QVWc7pY/frame-08-delay-0-07s.gif",
      "https://i.postimg.cc/qqgmYgL9/frame-09-delay-0-07s.gif",
      "https://i.postimg.cc/MH4s8x3X/frame-10-delay-0-07s.gif",
      "https://i.postimg.cc/3rbfGCr7/frame-11-delay-0-07s.gif"
    ],
    size: 1.0,
    spinSpeed: 100,
    pairId: "3BfzLnxHVaYJNrAP6SxfT7Z8nFe5ybKL6JMTuCrNR8zZ",
    supply: 999974598,
     x: "https://x.com/NyanCatOnBAGS",        // <-- add X link here
    website: "https://nyancoin.io/"},

    { name: "Orynth", frames: [
      "https://i.postimg.cc/q7Qn6rVR/Orynth1.png",
      "https://i.postimg.cc/zG635H8q/Orynth2.png",
      "https://i.postimg.cc/d0C30QVr/Orynth3.png",
      "https://i.postimg.cc/W1htQwR9/Orynth4.png",
      "https://i.postimg.cc/wTW7fbry/Orynth5.png",
      "https://i.postimg.cc/mDGD1xPq/Orynth6.png",
      "https://i.postimg.cc/nzYLvd7L/Orynth7.png",
      "https://i.postimg.cc/GtLmzkJx/Orynth8.png"
    ],
    size: 1.0,
    spinSpeed: 120,
    pairId: "C53QBLiDTYhQEgsHKQDS4kEAwEKty1nDkYxF6w67dvBh",
    supply: 999987590,
     x: "https://x.com/orynthai",        // <-- add X link here
    website: "https://www.orynth.dev/"},

    { name: "PEPE", frames: [
      "https://i.postimg.cc/3wFxwVJ9/Pepe1.png",
      "https://i.postimg.cc/cHD1R33n/Pepe2.png",
      "https://i.postimg.cc/qqzJj7cZ/Pepe3.png",
      "https://i.postimg.cc/xCjTN5XQ/Pepe4.png",
      "https://i.postimg.cc/3NVK6Hnr/Pepe5.png",
      "https://i.postimg.cc/05B2rpPg/Pepe6.png"
    ],
    size: 1.0,
    spinSpeed: 200,
    pairId: "8Lvqv2jgNvcx1NDtMHd5Ahx8ZUjETfLwygq9MtDfPHxe",
    supply: 999826244,
     x: "https://x.com/PepeOnBAGS_",        // <-- add X link here
    website: "https://x.com/i/communities/1953556908318818730"},

    {
  name: "HAT", // NEW CHARACTER NAME
  frames: [
    "https://i.postimg.cc/65BzwWxP/Gorro1.png",
    "https://i.postimg.cc/Y0z3gVY8/Gorro2.png",
    "https://i.postimg.cc/WbS81B21/Gorro3.png",
    "https://i.postimg.cc/1RGMLg26/Gorro4.png",
    "https://i.postimg.cc/Qdtb9ftk/Gorro5.png"
  ],
  size: 1.0,               // scale multiplier
  spinSpeed: 200,          // milliseconds per frame
  pairId: "3HP2Gg5sTaNta2ztzrRCA63btYSeyptASkGLcyQXWfBU", // replace with actual DexScreener pair ID
  supply: 978965646,
      x: "https://x.com/i/communities/1953347503736443163",        // <-- add X link here
    website: ""},

    {
  name: "LAMBO", // NEW CHARACTER NAME
  frames: [
    "https://i.postimg.cc/gjRxGcbN/labo2.png"
  ],
  size: 1.25,               // scale multiplier
  spinSpeed: 200,          // milliseconds per frame
  pairId: "DDizsNbsgwgX3icRb6JQ8vFrRa5cN5Nuj6u63dRAoDQv", // replace with actual DexScreener pair ID
  supply: 999915202,
      x: "https://x.com/i/communities/1956762307033477526",        // <-- add X link here
    website: ""},

    {
  name: "GIF", // NEW CHARACTER NAME
  frames: [
    "https://i.postimg.cc/W43yXcY4/Pepe1-1.png"
  ],
  size: 1,               // scale multiplier
  spinSpeed: 200,          // milliseconds per frame
  pairId: "AZsYKPRGyrTX5vQoY34u4aZgGjpWRY94YhYPnCrZTxXK", // replace with actual DexScreener pair ID
  supply: 939301970,
      x: "https://x.com/gifmefrog",        // <-- add X link here
    website: "https://x.com/i/communities/1956850684009324849"},
  ];

  // Per-character fine-tune multipliers
  const characterScaleTweaks = {
    Billie: 0.78,
    Bagz: 0.78,
    Finn: 0.78,
    Nippie: 0.78,
    Anon: 0.78,
    LAMBO: 1,
  };

  // ===== State & DOM =====
  let currentCharIndex = 0;
  let currentFrame = 0;
  let intervalId;

  const $character = document.getElementById("character");
  const $turnBtn = document.getElementById("turnBtn");
  const $effectBtn = document.getElementById("effectBtn");
  const $paintBtn = document.getElementById("paintBtn");
  const $prevChar = document.getElementById("prevChar");
  const $nextChar = document.getElementById("nextChar");
  const $charName = document.getElementById("charName");
  const $priceContainer = document.getElementById("priceContainer");
  const $characterImg = document.getElementById("character");

  // Preload frames
  characters.forEach(ch => ch.frames.forEach(src => { const img = new Image(); img.src = src; }));

  function getViewportScale(){
    const w = window.innerWidth;
    if(w < 480) return 0.68; // small phones
    if(w < 768) return 0.82; // tablets
    if(w < 1200) return 0.94; // small desktops
    return 1; // large
  }

  function setCharacter(){
    const ch = characters[currentCharIndex];
    currentFrame = 0;
    const imgEl = document.getElementById('character');
    imgEl.src = ch.frames[currentFrame];

    const tweak = characterScaleTweaks[ch.name] ?? 0.78;
    const effective = ch.size * tweak * getViewportScale();
    imgEl.style.setProperty('--char-size', effective);

    const title = FORCE_UPPERCASE ? ch.name.toUpperCase() : ch.name;
    $charName.textContent = title;
    $charName.dataset.text = title;

    if(ENABLE_TITLE_EFFECTS){
      const effect = EFFECTS_POOL[Math.floor(Math.random() * EFFECTS_POOL.length)];
      $charName.className = effect;
    } else {
      $charName.className = '';
    }

    // === Update Social Links ===
    const xLink = document.getElementById("socialX");
    const webLink = document.getElementById("socialWeb");

    if (ch.x) {
      xLink.href = ch.x;
      xLink.style.display = "inline-block";
    } else {
      xLink.style.display = "none";
    }

    if (ch.website) {
      webLink.href = ch.website;
      webLink.style.display = "inline-block";
    } else {
      webLink.style.display = "none";
    }

    updatePrice(ch);
}

  async function updatePrice(ch) {
  const changeEl = document.getElementById('change24h');

  if (!ch.pairId) {
    $priceContainer.textContent = "Price unavailable";
    changeEl.textContent = '';
    return;
  }

  try {
    const res = await fetch(`https://api.dexscreener.com/latest/dex/pairs/solana/${ch.pairId}`);
    const data = await res.json();

    const price = data.pair?.priceUsd ? parseFloat(data.pair.priceUsd) : 0;
    const priceStr = price.toFixed(6);

    const mcap = ch.supply ? (ch.supply * price) : 0;
    const mcapStr = mcap.toLocaleString(undefined, { maximumFractionDigits: 0 });

    // 24h price change
    const changeEl = document.getElementById('change24h');

const change = data.pair?.priceChange?.h24 ?? 0;
const formattedChange = `${Math.abs(change).toFixed(2)}%`;

if (change > 0) {
  changeEl.textContent = `ü§ë +${formattedChange}`;
  changeEl.style.color = '#00ff00'; // bright green
  changeEl.style.fontSize = '1.3em'; // slightly bigger emoji
} else if (change < 0) {
  changeEl.textContent = `üòà -${formattedChange}`;
  changeEl.style.color = '#ff3333'; // bright red
  changeEl.style.fontSize = '1.3em';
} else {
  changeEl.textContent = `0.00%`;
  changeEl.style.color = '#ffffff';
  changeEl.style.fontSize = '1.2em';
}


    $priceContainer.textContent = `Price: $${priceStr} | MCAP: $${mcapStr}`;
  } catch (err) {
    console.error(err);
    $priceContainer.textContent = "Price unavailable";
    changeEl.textContent = '';
  }
}


  // ===== Spin logic =====
  function nextFrame(){
    const ch = characters[currentCharIndex];
    currentFrame = (currentFrame + 1) % ch.frames.length;
    document.getElementById('character').src = ch.frames[currentFrame];
  }
  function startSpin(){
    const ch = characters[currentCharIndex];
    clearInterval(intervalId);
    intervalId = setInterval(nextFrame, ch.spinSpeed);
  }
  function stopSpin(){ clearInterval(intervalId); }

  $turnBtn.addEventListener('click', nextFrame);
  $turnBtn.addEventListener('pointerdown', (e)=>{ e.preventDefault(); startSpin(); });
  window.addEventListener('pointerup', stopSpin);
  $turnBtn.addEventListener('pointerleave', stopSpin);

  // Glow toggle
  $effectBtn.addEventListener('click', ()=> document.getElementById('character').classList.toggle('glow'));

  // Background color cycling
  const hues = ["#a25647", "#4a90e2", "#f5a623", "#7ed321", "#9b59b6",'#000000'];
  let hueIndex = 0;
  $paintBtn.addEventListener('click', ()=>{ hueIndex = (hueIndex + 1) % hues.length; document.documentElement.style.setProperty('--bg-base', hues[hueIndex]); });

  // Character navigation
  $prevChar.addEventListener('click', ()=>{ currentCharIndex = (currentCharIndex - 1 + characters.length) % characters.length; setCharacter(); });
  $nextChar.addEventListener('click', ()=>{ currentCharIndex = (currentCharIndex + 1) % characters.length; setCharacter(); });

  // ===== PARTICLE EFFECTS (snow / blood / candles / matrix) =====
const particleCanvas = document.getElementById('particleCanvas');
const pctx = particleCanvas.getContext('2d');

function sizeParticleCanvas(){
  particleCanvas.width = window.innerWidth;
  particleCanvas.height = window.innerHeight;
}
sizeParticleCanvas();

let particles = [];
let effectMode = 1; // 0=off, 1=snow, 2=blood, 3=candles, 4=matrix
const effectIcons = ["‚≠ï","‚ùÑÔ∏è","ü©∏","üïØÔ∏è","üíö"];
const effectToggleBtn = document.getElementById('effectToggle');
effectToggleBtn.textContent = effectIcons[effectMode];

const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)');

// ===== MATRIX CHARACTERS & CONFIG =====
const japaneseChars = "„Ç¢„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É©„ÉØ„Ç§„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„Ç¶„Ç®„Ç±„Çª„ÉÜ„Éç„Éò„É°„É¨„Ç™„Ç≥„ÇΩ„Éà„Éé„Éõ„É¢„É®„É≠„É≤0123456789";
const matrixSpeed = 20;    // pixels per frame
const colSpacing = 22;     // horizontal spacing between columns
const lineSpacing = 19;    // font size / vertical spacing
const fade = 0.1;          // trail fade
let matrixColumns = [];

function randomJapaneseChar() {
  return japaneseChars.charAt(Math.floor(Math.random() * japaneseChars.length));
}

function initMatrix() {
  matrixColumns = [];
  const colCount = Math.floor(particleCanvas.width / colSpacing);
  for(let i = 0; i < colCount; i++) {
    matrixColumns[i] = Math.random() * particleCanvas.height;
  }
}

// ===== SPAWN OTHER PARTICLES =====
function spawnParticle() {
  if(reduceMotion.matches) return;

  if(effectMode === 1){ // snow
    if(particles.length < 160){
      particles.push({
        t: 'snow',
        x: Math.random() * particleCanvas.width,
        y: -10 - Math.random()*20,
        r: 1.5 + Math.random()*3,
        vx: (Math.random()*1.4 - 0.7),
        vy: 0.6 + Math.random()*1.6,
        o: 0.4 + Math.random()*0.6
      });
    }
  } else if(effectMode === 2){ // blood
    if(particles.length < 60){
      particles.push({
        t: 'blood',
        x: Math.random() * particleCanvas.width,
        y: -20 - Math.random()*40,
        r: 2 + Math.random()*3,
        vx: (Math.random()*0.4 - 0.2),
        vy: 2 + Math.random()*2,
        o: 0.8
      });
    }
  } else if(effectMode === 3){ // candles
    if(particles.length < 90){
      particles.push({
        t: 'candle',
        x: Math.random() * particleCanvas.width,
        y: particleCanvas.height + (10 + Math.random()*30),
        w: 2 + Math.random()*8,
        h: 20 + Math.random()*90,
        vy: -(2 + Math.random()*3),
        o: 0.6 + Math.random()*0.4,
        glow: Math.random()*0.6 + 0.2
      });
    }
  }
}

// ===== DRAW PARTICLES & MATRIX =====
function drawParticles(){
  if(effectMode === 4){ // MATRIX
    pctx.fillStyle = `rgba(0,0,0,${fade})`;
    pctx.fillRect(0,0,particleCanvas.width,particleCanvas.height);

    pctx.fillStyle = '#0F0';
    pctx.font = `${lineSpacing}px monospace`;

    for(let i=0; i<matrixColumns.length; i++){
      const char = randomJapaneseChar();
      const x = i * colSpacing;
      const y = matrixColumns[i];
      pctx.fillText(char, x, y);
      matrixColumns[i] += matrixSpeed;
      if(matrixColumns[i] > particleCanvas.height) matrixColumns[i] = 0;
    }
    return;
  }

  pctx.clearRect(0,0,particleCanvas.width, particleCanvas.height);
  for(let i = particles.length - 1; i >= 0; i--){
    const p = particles[i];
    if(p.t === 'snow'){
      pctx.globalAlpha = p.o;
      pctx.fillStyle = '#fff';
      pctx.beginPath();
      pctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      pctx.fill();
      p.x += p.vx;
      p.y += p.vy;
      if(p.x > particleCanvas.width) p.x = 0;
      if(p.x < 0) p.x = particleCanvas.width;
      if(p.y > particleCanvas.height + 40) particles.splice(i,1);
    } else if(p.t === 'blood'){
      pctx.globalAlpha = p.o;
      pctx.fillStyle = 'rgba(200,0,0,1)';
      pctx.beginPath();
      pctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      pctx.fill();
      if(p.y + p.r >= particleCanvas.height - 2){
        const splashCount = 2 + Math.floor(Math.random()*3);
        for(let s=0;s<splashCount;s++){
          const sx = p.x + (Math.random()*p.r*2 - p.r);
          const sy = particleCanvas.height - 2 + Math.random()*3;
          const sr = Math.random()*p.r*0.6 + 1;
          pctx.beginPath();
          pctx.arc(sx, sy, sr, 0, Math.PI*2);
          pctx.fill();
        }
      }
      p.x += p.vx;
      p.y += p.vy;
      if(p.y > particleCanvas.height + 40) particles.splice(i,1);
    } else if(p.t === 'candle'){
      pctx.globalAlpha = p.o;
      const x = p.x - p.w/2;
      pctx.fillStyle = 'rgba(0,220,80,1)';
      pctx.fillRect(x, p.y, p.w, -p.h);
      pctx.globalAlpha = 0.12 * p.glow;
      pctx.fillStyle = 'rgba(0,255,120,1)';
      pctx.fillRect(x - p.w, p.y - p.h - 6, p.w*3, 6);
      p.y += p.vy;
      if(p.y + p.h < -40) particles.splice(i,1);
    }
  }
  pctx.globalAlpha = 1;
}

let particleRAF;
function particleLoop(){
  if(effectMode !== 0) spawnParticle();
  drawParticles();
  particleRAF = requestAnimationFrame(particleLoop);
}
particleLoop();

// ===== EFFECT TOGGLE =====
effectToggleBtn.addEventListener('click', () => {
  effectMode = (effectMode + 1) % 5;
  effectToggleBtn.textContent = effectIcons[effectMode];
  particles = [];
  if(effectMode === 4) initMatrix();
});

window.addEventListener('resize', () => {
  sizeParticleCanvas();
  if(effectMode === 4) initMatrix();
});

reduceMotion.addEventListener?.('change', () => {
  if(reduceMotion.matches){
    effectMode = 0;
    effectToggleBtn.textContent = effectIcons[effectMode];
    particles = [];
  }
});

// INIT MATRIX ON START
if(effectMode === 4) initMatrix();



  // helper to update char size on resize
  function updateCharSize(){ const ch = characters[currentCharIndex]; const tweak = characterScaleTweaks[ch.name] ?? 0.78; const effective = ch.size * tweak * getViewportScale(); document.getElementById('character').style.setProperty('--char-size', effective); }

  // ===== Init =====
  setCharacter();
  // Note: particleLoop already started
</script>
</body>
</html>



